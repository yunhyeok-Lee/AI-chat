"""Simple console chatbot using the OpenAI API with conversational memory."""
from __future__ import annotations

from chat_backend import ChatSession, EXIT_COMMANDS


def chat(model: str = "gpt-4o-mini") -> None:
    """Interactive command-line chat loop that keeps conversation context."""
    session = ChatSession(model=model)
    print(f"Using model: {session.model_name}")
    print("Chat session ready. Type 'exit' to quit.\n")
    while True:
        try:
            user_input = input("You: ").strip()
        except (EOFError, KeyboardInterrupt):
            print("\nGoodbye!")
            break
        if not user_input:
            continue
        if user_input.lower() in EXIT_COMMANDS:
            print("Goodbye!")
            break
        try:
            assistant_text = session.send(user_input)
        except Exception as exc:  # pragma: no cover - network/API errors
            print(f"[Error] OpenAI API request failed: {exc}")
            if len(session.messages) > 1:
                session.messages.pop()
            continue
        print(f"Assistant: {assistant_text}")


if __name__ == "__main__":
    chat()
